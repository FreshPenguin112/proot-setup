pkg install -y x11-repo; 
pkg install -y clang lld binutils cmake autoconf automake libtool ndk-sysroot ndk-multilib make python git libandroid-shmem-static 'vulkan*' ninja llvm bison flex libx11 xorgproto libdrm libpixman libxfixes libjpeg-turbo xtrans libxxf86vm xorg-xrandr xorg-font-util xorg-util-macros libxfont2 libxkbfile libpciaccess xcb-util-renderutil xcb-util-image xcb-util-keysyms xcb-util-wm xorg-xkbcomp xkeyboard-config libxdamage libxinerama;
pip install meson mako;
mkdir ~/tmp;
cd ~/tmp;
LD_PRELOAD='' git clone --depth 1 -b libxshmfence-1.3 https://gitlab.freedesktop.org/xorg/lib/libxshmfence.git;
LD_PRELOAD='' git clone --depth 1 https://gitlab.freedesktop.org/mesa/mesa.git;
LD_PRELOAD='' git clone --depth 1 -b 1.5.10 https://github.com/anholt/libepoxy.git;
LD_PRELOAD='' git clone --shallow-since 2022-06-27 https://gitlab.freedesktop.org/virgl/virglrenderer.git;
cd ~/tmp/libxshmfence;./autogen.sh --prefix=$PREFIX --with-shared-memory-dir=$TMPDIR;
sed -i s/values.h/limits.h/ ./src/xshmfence_futex.h;
make -j8 install CPPFLAGS=-DMAXINT=INT_MAX;
cd ~/tmp/mesa;
git apply /sdcard/Download/mesa20221219.patch; 
mkdir b; 
cd b; 
LDFLAGS='-l:libandroid-shmem.a -llog' meson .. -Dprefix=$PREFIX -Dplatforms=x11 -Dgbm=enabled -Ddri-drivers='' -Dgallium-drivers=zink,swrast -Dllvm=enabled -Dvulkan-drivers='' -Dcpp_rtti=false -Dc_args=-Wno-error=incompatible-function-pointer-types -Dbuildtype=release;
rm $PREFIX/lib/libglapi.so*;
rm $PREFIX/lib/libGL.so*;
rm $PREFIX/lib/libGLES*;
rm $PREFIX/lib/libEGL*;
rm $PREFIX/lib/libgbm*;
ninja install;
cd ~/tmp/libepoxy;
mkdir b;
cd b;
meson -Dprefix=$PREFIX -Dbuildtype=release -Dglx=yes -Degl=yes -Dtests=false -Dc_args=-U__ANDROID__ ..;
rm $PREFIX/lib/libepoxy.so*;
ninja install;
cd ~/tmp/virglrenderer;
git checkout -f dd301caf7e05ec9c09634fb7872067542aad89b7~2;
sed -i 's+"/tmp+"/data/data/com.termux/files/usr/tmp+' vtest/vtest_protocol.h;
mkdir b;
cd b;
meson -Dbuildtype=release -Dprefix=$PREFIX -Dplatforms=egl ..;
ninja install;
